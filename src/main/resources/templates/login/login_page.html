<!DOCTYPE html>
<html lang="en" xmlns:th="www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Login Page - Now UI Kit by Creative Tim</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
          name='viewport'/>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"/>
    <!-- CSS Files -->
    <link th:href="@{${loginResPath}}+'/css/bootstrap.min.css'" rel="stylesheet"/>
    <link th:href="@{${loginResPath}}+'/css/now-ui-kit.css?v=1.1.0'" rel="stylesheet"/>
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link th:href="@{${loginResPath}}+'/css/demo.css'" rel="stylesheet"/>
    <link href="/res/pop/css/bs4.pop.css" rel="stylesheet"/>
    <!-- Canonical SEO -->
    <link rel="canonical" href=""/>
    <!--  Social tags      -->
    <meta name="keywords" content="">
    <meta name="description" content="">
    <style>
        input:-webkit-autofill, textarea:-webkit-autofill, select:-webkit-autofill {
            background-color: rgb(250, 255, 189); /* #FAFFBD; */
            background-image: none;
            color: rgb(0, 0, 0);
        }
    </style>

</head>

<body class="login-page sidebar-collapse">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-transparent " color-on-scroll="400">
    <div class="container">
        <div class="dropdown button-dropdown">
            <a href="#pablo" class="dropdown-toggle" id="navbarDropdown" data-toggle="dropdown">
                <span class="button-bar"></span>
                <span class="button-bar"></span>
                <span class="button-bar"></span>
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-header">Dropdown header</a>
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <a class="dropdown-item" href="#">Something else here</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Separated link</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">One more separated link</a>
            </div>
        </div>
        <div class="navbar-translate">
            <a class="navbar-brand" href="#" rel="tooltip" data-placement="bottom">
                Now Ui Kit
            </a>
            <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
                    aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse justify-content-end" data-nav-image="assets/img/blurred-image-1.jpg">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#">Back to Kit</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#/issues">Have an issue?</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" rel="tooltip" title="Follow us on Twitter" data-placement="bottom"
                       href="#CreativeTim" target="_blank">
                        <i class="fa fa-twitter"></i>
                        <p class="d-lg-none d-xl-none">Twitter</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" rel="tooltip" title="Like us on Facebook" data-placement="bottom"
                       href="#CreativeTim" target="_blank">
                        <i class="fa fa-facebook-square"></i>
                        <p class="d-lg-none d-xl-none">Facebook</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" rel="tooltip" title="Follow us on Instagram" data-placement="bottom" href="#"
                       target="_blank">
                        <i class="fa fa-instagram"></i>
                        <p class="d-lg-none d-xl-none">Instagram</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!-- End Navbar -->
<div class="page-header" filter-color="orange">
    <div class="page-header-image" style="background-image:url(/res/assets_login/img/login.jpg)"></div>
    <div class="container">
        <div class="col-md-4 content-center">
            <div class="card card-login card-plain">
                <form id="formBox" class="form" method="" action="">
                    <div class="header header-primary text-center">
                        <div class="logo-container">
                            <img th:src="@{${loginResPath}}+'/img/now-logo.png'" alt="">
                        </div>
                    </div>
                    <div id="content" class="content">
                        <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons users_circle-08"></i>
                                </span>
                            <input id="userName" type="text" AUTOCOMPLETE="off" class="form-control" placeholder="用户名">
                        </div>
                        <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons text_caps-small"></i>
                                </span>
                            <input id="passWord" type="password" placeholder="密码" class="form-control"/>
                        </div>
                    </div>
                    <div class="footer text-center">
                        <a id="loginBtn" href="javascript:;" class="btn btn-primary btn-round btn-lg btn-block"
                           onclick="login()">登录</a>
                    </div>
                    <div class="pull-left">
                        <h6 id="createBtnBox">
                            <a id="createBtn" href="javascript:;" onclick="register()" class="link">创建账号</a>
                        </h6>
                    </div>
                    <div class="pull-right">
                        <h6>
                            <a href="javascript:;" class="link">需要帮助?</a>
                        </h6>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <nav>
                <ul>
                    <li>
                        <a href="#">
                            Creative Tim
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            About Us
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            Blog
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            MIT License
                        </a>
                    </li>
                </ul>
            </nav>
            <!--<div class="copyright">-->
            <!--&copy;-->
            <!--</div>-->
        </div>
    </footer>
</div>
</body>
<!--   Core JS Files   -->
<script th:src="@{${loginResPath}}+'/js/core/jquery.3.2.1.min.js'" type="text/javascript"></script>
<script th:src="@{${loginResPath}}+'/js/core/popper.min.js'" type="text/javascript"></script>
<script th:src="@{${loginResPath}}+'/js/core/bootstrap.min.js'" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script th:src="@{${loginResPath}}+'/js/plugins/bootstrap-switch.js'"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script th:src="@{${loginResPath}}+'/js/plugins/nouislider.min.js'" type="text/javascript"></script>
<!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
<script th:src="@{${loginResPath}}+'/js/plugins/bootstrap-datepicker.js'" type="text/javascript"></script>
<!-- Share Library etc -->
<script th:src="@{${loginResPath}}+'/js/plugins/jquery.sharrre.js'" type="text/javascript"></script>
<!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
<script th:src="@{${loginResPath}}+'/js/now-ui-kit.js?v=1.1.0'" type="text/javascript"></script>
<script src="/res/pop/js/bs4.pop.js" type="text/javascript"></script>
<script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script>
    // 登录
    function login() {
        let username = $("#userName").val().trim();
        let password = $("#passWord").val().trim();
        if (username == '') {
            bs4pop.notice('用户名不能为空!', {position: 'topcenter'});
            $("#userName").focus();
            return false;
        }
        if (password == '') {
            bs4pop.notice('密码不能为空!', {position: 'topcenter'});
            $("#passWord").focus();
            return false;
        }
        $.ajax({
            url: "login_check.html",
            dataType: "json",
            type: "post",
            data: {
                userName: username,
                passWord: password
            },
            success: function (data) {
                if (data.code == 1000) {
                    bs4pop.notice("登录成功", {position: 'topcenter'});
                    setTimeout(function () {
                        $.cookie('accountId', username, { expires: 1 ,path:  "/"});
                        console.log($.cookie("accountId"))
                        $(location).prop('href', data.msg);
                        // $(location).prop("pathname",data.msg);
                        // console.log($(location))
                    }, 100);
                } else {
                    bs4pop.notice(data.msg, {position: 'topcenter'});
                }
            },
            error: function () {
                bs4pop.notice('系统异常,请稍后重试!', {position: 'topcenter'});
            }
        })
    }

    // 注册
    function register() {
        $("#createBtn").hide();
        $("#userName").val("");
        $("#passWord").val("");
        $("#createBtnBox").append("<a id=\"backBtn\" href=\"javascript:;\" onclick=\"loginInnit()\" class=\"link\">←</a>")
        $("#userName").blur(nameCheck);
        let pwdCheckStr = " <div id='passwordCheckBox' class=\"input-group form-group-no-border input-lg\">\n" +
            "                                <span class=\"input-group-addon\">\n" +
            "                                    <i class=\"now-ui-icons text_caps-small\"></i>\n" +
            "                                </span>\n" +
            "                            <input id=\"passWordCheck\" type=\"password\" placeholder=\"请确认密码\" class=\"form-control\"/>\n" +
            "                        </div>";
        $("#content").append(pwdCheckStr);
        $("#loginBtn").removeAttr("onclick");
        $("#loginBtn").text("注册");
    }

    // 用户名验证
    function nameCheck() {
        let username = $("#userName").val().trim();
        $.ajax({
            url: "name_check.html",
            dataType: "json",
            type: "post",
            data: {
                userName: username,
            },
            success: function (data) {
                if (data.code != 1000) {
                    bs4pop.notice("当前用户名不可用", {position: 'topcenter'});
                    $("#userName").focus();
                } else {
                    $("#loginBtn").removeAttr("onclick");
                    $("#loginBtn").click(nameRegister);
                }
            },
            error: function () {
                bs4pop.notice('系统异常,请稍后重试!', {position: 'topcenter'});
            }
        });
    }

    // 用户注册
    function nameRegister() {

        let userName = $("#userName").val().trim();
        let passWord = $("#passWord").val().trim();
        let passwordCheck = $("#passWordCheck").val().trim();
        // todo 使用正则验证
        if(passWord == "" && passwordCheck == ""){
            bs4pop.notice("密码不能为空!", {position: 'topcenter'});
            $("#passWord").focus();
            return;
        }
        if (passWord != passwordCheck) {
            bs4pop.notice("两次密码不一致!", {position: 'topcenter'});
            $("#passWord").focus();
            return;
        }
        $.ajax({
            url: "login_register.html",
            dataType: "json",
            type: "post",
            data: {
                userName: userName,
                passWord: passWord
            },
            success: function (data) {
                if (data.code = 1000) {
                    bs4pop.notice("注册成功!", {position: 'topcenter'});
                    loginInnit();
                } else {
                    bs4pop.notice(data.msg, {position: 'topcenter'});
                }
            },
            error: function () {
                bs4pop.notice('系统异常,请稍后重试!', {position: 'topcenter'});
            }
        })
    }

    function loginInnit() {
        $("#loginBtn").unbind("click");
        $("#loginBtn").click(login);
        $("#loginBtn").text("登录");
        $("#userName").unbind("blur");
        $("#passwordCheckBox").remove();
        $("#backBtn").remove();
        $("#createBtn").show();
    }

</script>
</html>